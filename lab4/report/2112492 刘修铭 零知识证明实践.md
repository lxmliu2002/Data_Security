# <center>数据安全实验报告</center>

<center>Lab4 零知识证明实践</center>

<center> 网络空间安全学院 信息安全专业</center>

<center> 2112492 刘修铭 1036</center>

## 实验要求






## 实验原理

### libsnark

libsnark 是用于开发 zkSNARK 应用的 C++ 代码库，由 SCIPR Lab 开发并采用商业友好的 MIT 许可证（但附有例外条款）在 GitHub 上（[https://github.com/scipr-lab/libsnark](https://github.com/scipr-lab/libsnark）开源。libsnark 框架提供了多个通用证明系统的实现，其中使用较多的是 BCTV14a 和 Groth16。查看 `libsnark/libsnark/zk_proof_systems` 路径，就能发现 libsnark 对各种证明系统的具体实现，并且均按不同类别进行了分类，还附上了实现依照的具体论文。其中： 

• zk_proof_systems/ppzksnark/r1cs_ppzksnark 对应的是 BCTV14a 

• zk_proof_systems/ppzksnark/r1cs_gg_ppzksnark 对应的是 Groth16 

ppzksnark 是指 preprocessing zkSNARK。这里的 preprocessing 是指可信设置 (trusted setup)，即在证明生成和验证之前，需要通过一个生成算法来创建相关的公共参数（证明密钥和验证密钥）。这个提前生成的参数就是公共参考串 CRS。

 



## 实验过程（含主要源代码）

### 实验环境配置

libsnark 的安装是**<u>相当及其</u>**麻烦，各种套娃安装。本人在此按照实验指导书一步步安装，事后经过查询，有开源的配置好的 **<u>docker 镜像</u>**，后续可以考虑将其写入实验指导书。

#### xbyak 子模块安装

将相关文件复制好用，在终端运行命令 `sudo make install`，可以看到如下代码，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319090624507.png" alt="image-20240319090624507" style="zoom:50%;" />

#### ate-pairing 模块安装

复制好相关文件后，运行命令 `make -j`，得到如下输出：

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091112772.png" alt="image-20240319091112772" style="zoom:50%;" />

接着执行 `test/bin`，得到如下结果，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091151368.png" alt="image-20240319091151368" style="zoom:50%;" />

#### libsnark-supercop 模块安装

复制好相关文件，执行 `./do` 命令，得到如下结果，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091256121.png" alt="image-20240319091256121" style="zoom:50%;" />

#### libff 模块安装

**<u>递归</u>**复制好相关文件后，执行相关命令进行编译与运行，最后运行 `make check` 进行检测，得到如下结果，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091412938.png" alt="image-20240319091412938" style="zoom:33%;" />

#### libfqfft 模块安装

**<u>递归</u>**复制好相关文件后，执行相关命令进行编译与运行，最后运行 `make check` 进行检测，得到如下结果，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091444314.png" alt="image-20240319091444314" style="zoom: 33%;" />

#### libsnark 编译安装

安装好前面所有的模块后，在 `~/Libsnark/libsnark_abc-master/depends/libsnark` 下打开终端，执行相关命令进行编译与安装，最后运行 `make check` 进行检测，得到如下结果，说明安装成功。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091553619.png" alt="image-20240319091553619" style="zoom:33%;" />

#### 整体编译安装

在 `~/Libsnark/libsnark_abc-master` 下打开终端，执行相关命令进行编译安装，最后执行 `./src/test`，测试执行。




















## 实验结果及分析

### 实验环境配置

执行 `./src/test`，测试执行，得到如下结果，说明已经顺利拥有 zkSNARK 应用开发环境，并成功跑通第一个 demo。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319091731390.png" alt="image-20240319091731390" style="zoom: 33%;" />





## 遇到的问题及解决方案

### LF 与 CRLF

在配置环境时，本人首先将用到的压缩包下载到本地，解压后移动至 wsl 中，发生了如下报错。经过确认，此问题是由于 Windows 与 Linux 文件格式不同导致。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%9B%B6%E7%9F%A5%E8%AF%86%E8%AF%81%E6%98%8E%E5%AE%9E%E8%B7%B5.pic/image-20240319090753938.png" alt="image-20240319090753938" style="zoom:50%;" />

后续再安装时，在 Linux 系统下直接使用 `unzip` 命令解压即可，所有的文件不经过 Windows，直接在 Linux 系统下操作。




## 参考

本次实验主要参考教材内容完成。