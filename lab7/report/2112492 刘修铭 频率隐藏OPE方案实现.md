# <center>数据安全实验报告</center>

<center>Lab7 频率隐藏 OPE 方案实现</center>

<center> 网络空间安全学院 信息安全专业</center>

<center> 2112492 刘修铭 1036</center>

## 实验要求






## 实验原理



 



## 实验过程（含主要源代码）

### 实验环境配置

#### MySQL 的安装与配置

使用 `[sudo] apt install mysql-server libmysqlclient-dev` 命令在 Ubuntu 中安装 MySQL。

使用 `[sudo] mysql` 指令以 root 身份登陆数据库。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%A2%91%E7%8E%87%E9%9A%90%E8%97%8FOPE%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.pic/image-20240319141840097.png" alt="image-20240319141840097" style="zoom:50%;" />

接着使用 `create user` 指令创建用户 user，不限制 host，密码为 123456 的账户，并将所有数据库上的所有权限授予用户 user。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%A2%91%E7%8E%87%E9%9A%90%E8%97%8FOPE%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.pic/image-20240319141949461.png" alt="image-20240319141949461" style="zoom:50%;" />

接着使用 `CREATE database <name>` 指令创建数据库。

#### Python3 环境

本人已经安装好 python 环境，此处仅作展示。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%A2%91%E7%8E%87%E9%9A%90%E8%97%8FOPE%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.pic/image-20240319093625973.png" alt="image-20240319093625973" style="zoom:50%;" />

### 编写 Server 端程序

根据 FH-OPE 描述，创建 `Node.h` 文件，并将实验手册中的代码复制其中。

接着在同文件夹下创建对应的 `Node.cpp` 文件，并将对应的代码复制到其中。

接着创建一个 `UDF.cpp` 文件，将代码复制其中。

### 编译生成动态链接库

完成编写后，使用 `g++ -shared -fPIC UDF.cpp Node.cpp -lcrypto -o libope.so` 生成动态链接库，并使用 `sudo cp libope.so /usr/lib/mysql/plugin/` 命令将其拷贝到 MySQL 文件夹中。

### 导入 MySQL

按照实验手册说明，编写 sql 文件，并使用 `source` 指令导入 sql 文件。

### 编写 Client 端程序并测试

按照实验手册说明，编写 Client 部分代码，并将其存入 `client.py` 文件。


















## 实验结果及分析

### Client 端程序测试

编写完成后，使用 `python3 client.py` 指令执行 python 文件，可以看到打印的密文及其解密后的明文。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%A2%91%E7%8E%87%E9%9A%90%E8%97%8FOPE%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.pic/image-20240319142821674.png" alt="image-20240319142821674" style="zoom:50%;" />





## 遇到的问题及解决方案

### Crypto 库的安装

在运行 python 程序时，会提示 Crypto 报错。使用 `pip install Cyrpto` 指令安装后，仍无法解决。

经过[查询](https://blog.csdn.net/qq_29161009/article/details/135607933)，使用 `pip install pycryptodome` 指令安装另一个库即可解决。

<img src="./2112492%20%E5%88%98%E4%BF%AE%E9%93%AD%20%E9%A2%91%E7%8E%87%E9%9A%90%E8%97%8FOPE%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.pic/image-20240319142909921.png" alt="image-20240319142909921" style="zoom:50%;" />

接着又会提示 **<u>ModuleNotFoundError: No module named 'Crypto.Cipher'</u>**。经过[查询](https://blog.csdn.net/weixin_30364147/article/details/95722400)，需要对文件进行重命名，重命名之后即可成功运行。






## 参考

* 教材内容
* [https://blog.csdn.net/qq_29161009/article/details/135607933](https://blog.csdn.net/qq_29161009/article/details/135607933)

